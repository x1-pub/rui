# Rui æ¡†æ¶æµ‹è¯•å¥—ä»¶

è¿™æ˜¯ Rui Node.js/TypeScript æœåŠ¡ç«¯æ¡†æ¶çš„å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼Œæä¾›å…¨é¢çš„å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•ã€‚

## ğŸ“‹ æµ‹è¯•è¦†ç›–èŒƒå›´

### æ ¸å¿ƒæ¨¡å—æµ‹è¯•
- **ç±»å‹å®šä¹‰æµ‹è¯•** (`type.test.ts`) - éªŒè¯æ‰€æœ‰ TypeScript ç±»å‹å®šä¹‰
- **æ ¸å¿ƒåº”ç”¨æµ‹è¯•** (`core.test.ts`) - æµ‹è¯• App åŸºç±»çš„æ‰€æœ‰åŠŸèƒ½
- **è·¯ç”±å™¨æµ‹è¯•** (`router.test.ts`) - éªŒè¯è·¯ç”±åŒ¹é…ã€å‚æ•°è§£æã€è·¯ç”±ç»„ç­‰åŠŸèƒ½
- **è§£æå™¨æµ‹è¯•** (`parser.test.ts`) - æµ‹è¯•è¯·æ±‚ä½“è§£æã€æ–‡ä»¶ä¸Šä¼ ã€é”™è¯¯å¤„ç†
- **ä¸Šä¸‹æ–‡æµ‹è¯•** (`context.test.ts`) - éªŒè¯è¯·æ±‚ä¸Šä¸‹æ–‡çš„æ‰€æœ‰æ–¹æ³•å’Œå±æ€§
- **å›å¤å¤„ç†æµ‹è¯•** (`reply.test.ts`) - æµ‹è¯•å“åº”å¤„ç†ã€å†…å®¹ç±»å‹æ¨æ–­ã€é”™è¯¯å“åº”

### å…¥å£æ–‡ä»¶æµ‹è¯•
- **HTTP åº”ç”¨æµ‹è¯•** (`http.test.ts`) - HTTP æœåŠ¡å™¨åŠŸèƒ½æµ‹è¯•
- **HTTPS åº”ç”¨æµ‹è¯•** (`https.test.ts`) - HTTPS æœåŠ¡å™¨å’Œå®‰å…¨åŠŸèƒ½æµ‹è¯•
- **HTTP/2 åº”ç”¨æµ‹è¯•** (`http2.test.ts`) - HTTP/2 æœåŠ¡å™¨æ¨é€ã€æµæ§åˆ¶æµ‹è¯•
- **HTTP/2s åº”ç”¨æµ‹è¯•** (`http2s.test.ts`) - HTTP/2 å®‰å…¨æœåŠ¡å™¨ã€TLS éªŒè¯æµ‹è¯•

## ğŸ¯ æµ‹è¯•ç‰¹æ€§

### é«˜è¦†ç›–ç‡
- **è¡Œè¦†ç›–ç‡**: ç›®æ ‡ 80%+
- **åˆ†æ”¯è¦†ç›–ç‡**: ç›®æ ‡ 80%+
- **å‡½æ•°è¦†ç›–ç‡**: ç›®æ ‡ 80%+
- **è¯­å¥è¦†ç›–ç‡**: ç›®æ ‡ 80%+

### å…¨é¢çš„æµ‹è¯•åœºæ™¯
- âœ… æ­£å¸¸åŠŸèƒ½æµ‹è¯•
- âœ… é”™è¯¯å¤„ç†æµ‹è¯•
- âœ… è¾¹ç•Œæ¡ä»¶æµ‹è¯•
- âœ… æ€§èƒ½åŸºå‡†æµ‹è¯•
- âœ… ç±»å‹å®‰å…¨æµ‹è¯•
- âœ… å¹¶å‘å¤„ç†æµ‹è¯•
- âœ… å†…å­˜æ³„æ¼æ£€æµ‹
- âœ… å®‰å…¨ç‰¹æ€§æµ‹è¯•

### æµ‹è¯•ç±»å‹
- **å•å…ƒæµ‹è¯•**: æµ‹è¯•å•ä¸ªå‡½æ•°å’Œæ–¹æ³•
- **é›†æˆæµ‹è¯•**: æµ‹è¯•æ¨¡å—é—´çš„äº¤äº’
- **ç«¯åˆ°ç«¯æµ‹è¯•**: æµ‹è¯•å®Œæ•´çš„è¯·æ±‚-å“åº”æµç¨‹
- **æ€§èƒ½æµ‹è¯•**: éªŒè¯æ€§èƒ½æŒ‡æ ‡å’Œèµ„æºä½¿ç”¨
- **å®‰å…¨æµ‹è¯•**: éªŒè¯å®‰å…¨ä¸­é—´ä»¶å’Œ TLS åŠŸèƒ½

## ğŸš€ è¿è¡Œæµ‹è¯•

### å¿«é€Ÿå¼€å§‹
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# æˆ–ä½¿ç”¨æµ‹è¯•è„šæœ¬
chmod +x __test__/run-tests.sh
./__test__/run-tests.sh
```

### è¯¦ç»†å‘½ä»¤
```bash
# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
npx jest __test__/core.test.ts

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npx jest --coverage

# ç›‘è§†æ¨¡å¼è¿è¡Œæµ‹è¯•
npx jest --watch

# è¿è¡Œæ€§èƒ½æµ‹è¯•
npx jest --testPathPattern="performance"

# è¿è¡Œå®‰å…¨ç›¸å…³æµ‹è¯•
npx jest --testPathPattern="https|http2s"
```

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•å®Œæˆåä¼šç”Ÿæˆä»¥ä¸‹æŠ¥å‘Šï¼š

### è¦†ç›–ç‡æŠ¥å‘Š
- **HTML æŠ¥å‘Š**: `coverage/index.html`
- **LCOV æŠ¥å‘Š**: `coverage/lcov.info`
- **JSON æŠ¥å‘Š**: `coverage/coverage-final.json`

### æµ‹è¯•ç»“æœæŠ¥å‘Š
- **HTML æŠ¥å‘Š**: `coverage/test-report.html`
- **æ§åˆ¶å°è¾“å‡º**: è¯¦ç»†çš„æµ‹è¯•ç»“æœå’Œé”™è¯¯ä¿¡æ¯

## ğŸ”§ æµ‹è¯•é…ç½®

### Jest é…ç½® (`jest.config.js`)
- TypeScript æ”¯æŒ
- ESM æ¨¡å—æ”¯æŒ
- è¦†ç›–ç‡é…ç½®
- æµ‹è¯•è¶…æ—¶è®¾ç½®
- å¹¶å‘æµ‹è¯•é…ç½®

### ç¯å¢ƒè®¾ç½® (`setup.ts`)
- å…¨å±€æµ‹è¯•é…ç½®
- æ¨¡æ‹Ÿå¯¹è±¡è®¾ç½®
- æµ‹è¯•å·¥å…·å‡½æ•°
- é”™è¯¯å¤„ç†é…ç½®

## ğŸ“ æµ‹è¯•ç¼–å†™æŒ‡å—

### æµ‹è¯•ç»“æ„
```typescript
describe('æ¨¡å—åç§°', () => {
  beforeEach(() => {
    // æµ‹è¯•å‰è®¾ç½®
  })

  afterEach(() => {
    // æµ‹è¯•åæ¸…ç†
  })

  describe('åŠŸèƒ½åˆ†ç»„', () => {
    test('åº”è¯¥æ‰§è¡Œç‰¹å®šåŠŸèƒ½', () => {
      // æµ‹è¯•å®ç°
    })
  })
})
```

### æœ€ä½³å®è·µ
1. **æè¿°æ€§æµ‹è¯•åç§°**: ä½¿ç”¨æ¸…æ™°çš„ä¸­æ–‡æè¿°
2. **ç‹¬ç«‹æµ‹è¯•**: æ¯ä¸ªæµ‹è¯•åº”è¯¥ç‹¬ç«‹è¿è¡Œ
3. **å®Œæ•´è¦†ç›–**: æµ‹è¯•æ­£å¸¸æµç¨‹å’Œå¼‚å¸¸æƒ…å†µ
4. **æ€§èƒ½è€ƒè™‘**: é¿å…è¿‡é•¿çš„æµ‹è¯•æ‰§è¡Œæ—¶é—´
5. **æ¨¡æ‹Ÿå¯¹è±¡**: åˆç†ä½¿ç”¨ Mock å’Œ Spy
6. **æ–­è¨€æ¸…æ™°**: ä½¿ç”¨å…·ä½“çš„æ–­è¨€è€Œéé€šç”¨æ–­è¨€

### æµ‹è¯•åˆ†ç±»
- **å•å…ƒæµ‹è¯•**: æµ‹è¯•å•ä¸ªå‡½æ•°æˆ–æ–¹æ³•
- **é›†æˆæµ‹è¯•**: æµ‹è¯•æ¨¡å—é—´äº¤äº’
- **åŠŸèƒ½æµ‹è¯•**: æµ‹è¯•å®Œæ•´åŠŸèƒ½æµç¨‹
- **æ€§èƒ½æµ‹è¯•**: éªŒè¯æ€§èƒ½æŒ‡æ ‡
- **å®‰å…¨æµ‹è¯•**: éªŒè¯å®‰å…¨ç‰¹æ€§

## ğŸ› ï¸ è°ƒè¯•æµ‹è¯•

### è°ƒè¯•å•ä¸ªæµ‹è¯•
```bash
# ä½¿ç”¨ Node.js è°ƒè¯•å™¨
node --inspect-brk node_modules/.bin/jest --runInBand __test__/core.test.ts
```

### æŸ¥çœ‹è¯¦ç»†è¾“å‡º
```bash
# æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—
npx jest --verbose --no-coverage

# æ˜¾ç¤ºæ‰€æœ‰è¾“å‡º
npx jest --verbose --silent=false
```

## ğŸ“ˆ æŒç»­é›†æˆ

æµ‹è¯•å¥—ä»¶æ”¯æŒåœ¨ CI/CD ç¯å¢ƒä¸­è¿è¡Œï¼š

### GitHub Actions
```yaml
- name: è¿è¡Œæµ‹è¯•
  run: |
    npm install
    npm test
    
- name: ä¸Šä¼ è¦†ç›–ç‡æŠ¥å‘Š
  uses: codecov/codecov-action@v3
  with:
    file: ./coverage/lcov.info
```

### æœ¬åœ° Git Hooks
```bash
# æäº¤å‰è¿è¡Œæµ‹è¯•
git add .husky/pre-commit
echo "npm test" > .husky/pre-commit
chmod +x .husky/pre-commit
```

## ğŸ” æµ‹è¯•æŒ‡æ ‡

### æ€§èƒ½åŸºå‡†
- **è·¯ç”±åŒ¹é…**: < 1ms (1000 è·¯ç”±)
- **ä¸­é—´ä»¶æ‰§è¡Œ**: < 10ms (100 ä¸­é—´ä»¶)
- **è¯·æ±‚å¤„ç†**: < 50ms (ç®€å•è¯·æ±‚)
- **å†…å­˜ä½¿ç”¨**: < 100MB (åŸºç¡€åº”ç”¨)

### è´¨é‡æŒ‡æ ‡
- **æµ‹è¯•è¦†ç›–ç‡**: > 80%
- **æµ‹è¯•é€šè¿‡ç‡**: 100%
- **æ€§èƒ½å›å½’**: < 5%
- **å†…å­˜æ³„æ¼**: 0 æ£€æµ‹

## ğŸ¤ è´¡çŒ®æµ‹è¯•

### æ·»åŠ æ–°æµ‹è¯•
1. åœ¨ç›¸åº”çš„æµ‹è¯•æ–‡ä»¶ä¸­æ·»åŠ æµ‹è¯•ç”¨ä¾‹
2. ç¡®ä¿æµ‹è¯•è¦†ç›–æ–°åŠŸèƒ½çš„æ‰€æœ‰åˆ†æ”¯
3. è¿è¡Œæµ‹è¯•ç¡®ä¿é€šè¿‡
4. æ›´æ–°æ–‡æ¡£è¯´æ˜æ–°æµ‹è¯•çš„ç›®çš„

### æµ‹è¯•å‘½åè§„èŒƒ
- ä½¿ç”¨ä¸­æ–‡æè¿°æµ‹è¯•ç›®çš„
- æ ¼å¼: `åº”è¯¥ + åŠ¨ä½œ + é¢„æœŸç»“æœ`
- ä¾‹å¦‚: `åº”è¯¥æ­£ç¡®è§£æ JSON è¯·æ±‚ä½“`

### æäº¤æµ‹è¯•
```bash
git add __test__/
git commit -m "feat: æ·»åŠ  XXX åŠŸèƒ½çš„æµ‹è¯•ç”¨ä¾‹"
```

## ğŸ“š ç›¸å…³èµ„æº

- [Jest å®˜æ–¹æ–‡æ¡£](https://jestjs.io/docs/getting-started)
- [TypeScript Jest é…ç½®](https://jestjs.io/docs/getting-started#using-typescript)
- [æµ‹è¯•æœ€ä½³å®è·µ](https://github.com/goldbergyoni/javascript-testing-best-practices)
- [Node.js æµ‹è¯•æŒ‡å—](https://nodejs.org/en/docs/guides/testing/)

---

**æ³¨æ„**: è¿™ä¸ªæµ‹è¯•å¥—ä»¶æ˜¯ Rui æ¡†æ¶è´¨é‡ä¿è¯çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚æ‰€æœ‰çš„åŠŸèƒ½ä¿®æ”¹éƒ½åº”è¯¥ä¼´éšç›¸åº”çš„æµ‹è¯•æ›´æ–°ï¼Œç¡®ä¿æ¡†æ¶çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚